#include <Servo.h>
//모터 두개_초음파+led

#define trig 8
#define echo 9


Servo m1;
Servo m2;
int sw1=0;
int sw2=0;

unsigned long timeCurr, time, time1, time2; // 현재시간
long duration, distance;
int num=0; //버튼 저장

void setup() {
 pinMode(3,INPUT);
 pinMode(5,INPUT);
 m1.attach(2);
 m1.write(0);
 m2.attach(4);
 m2.write(0);
 pinMode(13,OUTPUT);//led 출력
 pinMode(10,OUTPUT);

 Serial.begin(9600);
 pinMode(trig, OUTPUT);
 pinMode(echo, INPUT);
}

void loop() {
  if(digitalRead(3)==HIGH || num==1)
  {
    Serial.println("1버튼 눌림");
    digitalWrite(13, HIGH);//led 켜지기
    num=0;
    time=millis();
    while(1){
        if(digitalRead(3)==HIGH && time+500<millis()){
          time1=millis();
          Serial.println("1버튼 다시 누름");
          digitalWrite(13,LOW);
          while(time1+500>millis()){}
          break;
        }
        if(digitalRead(5)==HIGH){
          Serial.println("1버튼->2버튼");
          num=2;
          digitalWrite(13,LOW);
          break;
         }
         
        digitalWrite(trig, LOW);
        digitalWrite(echo, LOW);
        delayMicroseconds(2);
        digitalWrite(trig, HIGH);
        delayMicroseconds(10);
        digitalWrite(trig, LOW);

        duration = pulseIn(echo, HIGH);
        distance = ((float)(340*duration)/10000)/2;

        Serial.print("거리: ");
        Serial.print(distance);
        Serial.println("cm");
        
          if (distance < 10){
            Serial.println("10cm 이내");
            m1.write(180);
            delay(3000);
            m1.write(0);
            digitalWrite(13, LOW);
            break;
          }
          else{
            timeCurr=millis();
            while(timeCurr+500>millis()){}
         }
         
    }
  }
  if(digitalRead(5)==HIGH || num==2)
  {
    Serial.println("2버튼 눌림");
    digitalWrite(10, HIGH);//led 번호 새거 해야함
    num=0;
    time=millis();
    while(1){
      if(digitalRead(5)==HIGH && time+500<millis()){
        time2=millis();
          Serial.println("2버튼 다시 누름");
          digitalWrite(10, LOW);  //led 번호 새거 해야함
          while(time2+500>millis()){}
          break;
        }
      digitalWrite(trig, LOW);
      digitalWrite(echo, LOW);
      delayMicroseconds(2);
      digitalWrite(trig, HIGH);
      delayMicroseconds(10);
      digitalWrite(trig, LOW);

      duration = pulseIn(echo, HIGH);
      distance = ((float)(340*duration)/10000)/2;

      Serial.print("거리: ");
      Serial.print(distance);
      Serial.println("cm");
    
      if (distance < 10){
        Serial.println("10cm 이내");
        m2.write(180);
        delay(3000);
        m2.write(0);
        digitalWrite(10, LOW);   //led 번호 새거 해야함
        break;
       }
        else{
            timeCurr=millis();
            while(timeCurr+500>millis()){
            }
            }
          if(digitalRead(3)==HIGH){
            
          Serial.println("2버튼->1버튼");
          num=1;
          digitalWrite(10,LOW);
          break;
         }
  }}}
